if(jQuery)(function(a){a.extend(a.fn,{selectBox:function(b,c){var d,e="",f=navigator.platform.match(/mac/i);var g=function(b,c){var d;if(navigator.userAgent.match(/iPad|iPhone|Android|IEMobile|BlackBerry/i))return false;if(b.tagName.toLowerCase()!=="select")return false;b=a(b);if(b.data("selectBox-control"))return false;var e=a('<a class="selectBox" />'),f=b.attr("multiple")||parseInt(b.attr("size"))>1;var g=c||{};e.width(b.outerWidth()).addClass(b.attr("class")).attr("title",b.attr("title")||"").attr("tabindex",parseInt(b.attr("tabindex"))).attr("style",b.attr("style")).css("display","inline-block").bind("focus.selectBox",function(){if(this!==document.activeElement&&document.body!==document.activeElement)a(document.activeElement).blur();if(e.hasClass("selectBox-active"))return;e.addClass("selectBox-active");b.trigger("focus")}).bind("blur.selectBox",function(){if(!e.hasClass("selectBox-active"))return;e.removeClass("selectBox-active");b.trigger("blur")});if(!a(window).data("selectBox-bindings")){a(window).data("selectBox-bindings",true).bind("scroll.selectBox",o).bind("resize.selectBox",o)}if(b.attr("disabled"))e.addClass("selectBox-disabled");b.bind("click.selectBox",function(a){e.focus();a.preventDefault()});if(f){d=h(b,"inline");e.append(d).data("selectBox-options",d).addClass("selectBox-inline selectBox-menuShowing").bind("keydown.selectBox",function(a){t(b,a)}).bind("keypress.selectBox",function(a){u(b,a)}).bind("mousedown.selectBox",function(b){if(a(b.target).is("A.selectBox-inline"))b.preventDefault();if(!e.hasClass("selectBox-focus"))e.focus()}).insertAfter(b);if(!b[0].style.height){var k=b.attr("size")?parseInt(b.attr("size")):5;var l=e.clone().removeAttr("id").css({position:"absolute",top:"-9999em"}).show().appendTo("body");l.find(".selectBox-options").html("<li><a> </a></li>");var m=parseInt(l.find(".selectBox-options A:first").html(" ").outerHeight());l.remove();e.height(m*k)}z(e)}else{var p=a('<span class="selectBox-label" />'),q=a('<span class="selectBox-arrow" />');p.attr("class",i(b)).text(j(b));d=h(b,"dropdown");d.appendTo("BODY");e.data("selectBox-options",d).addClass("selectBox-dropdown").append(p).append(q).bind("mousedown.selectBox",function(a){if(e.hasClass("selectBox-menuShowing")){o()}else{a.stopPropagation();d.data("selectBox-down-at-x",a.screenX).data("selectBox-down-at-y",a.screenY);n(b)}}).bind("keydown.selectBox",function(a){t(b,a)}).bind("keypress.selectBox",function(a){u(b,a)}).bind("open.selectBox",function(a,c){if(c&&c._selectBox===true)return;n(b)}).bind("close.selectBox",function(a,b){if(b&&b._selectBox===true)return;o()}).insertAfter(b);var r=e.width()-q.outerWidth()-parseInt(p.css("paddingLeft"))-parseInt(p.css("paddingLeft"));p.width(r);z(e)}b.addClass("selectBox").data("selectBox-control",e).data("selectBox-settings",g).hide()};var h=function(b,c){var d;var e=function(b,c){b.children("OPTION, OPTGROUP").each(function(){if(a(this).is("OPTION")){if(a(this).length>0){A(a(this),c)}else{c.append("<li> </li>")}}else{var b=a('<li class="selectBox-optgroup" />');b.text(a(this).attr("label"));c.append(b);c=e(a(this),c)}});return c};switch(c){case"inline":d=a('<ul class="selectBox-options" />');d=e(b,d);d.find("A").bind("mouseover.selectBox",function(c){q(b,a(this).parent())}).bind("mouseout.selectBox",function(c){r(b,a(this).parent())}).bind("mousedown.selectBox",function(a){a.preventDefault();if(!b.selectBox("control").hasClass("selectBox-active"))b.selectBox("control").focus()}).bind("mouseup.selectBox",function(c){o();p(b,a(this).parent(),c)});z(d);return d;case"dropdown":d=a('<ul class="selectBox-dropdown-menu selectBox-options" />');d=e(b,d);d.data("selectBox-select",b).css("display","none").appendTo("BODY").find("A").bind("mousedown.selectBox",function(a){a.preventDefault();if(a.screenX===d.data("selectBox-down-at-x")&&a.screenY===d.data("selectBox-down-at-y")){d.removeData("selectBox-down-at-x").removeData("selectBox-down-at-y");o()}}).bind("mouseup.selectBox",function(c){if(c.screenX===d.data("selectBox-down-at-x")&&c.screenY===d.data("selectBox-down-at-y")){return}else{d.removeData("selectBox-down-at-x").removeData("selectBox-down-at-y")}p(b,a(this).parent());o()}).bind("mouseover.selectBox",function(c){q(b,a(this).parent())}).bind("mouseout.selectBox",function(c){r(b,a(this).parent())});var f=b.attr("class")||"";if(f!==""){f=f.split(" ");for(var g in f)d.addClass(f[g]+"-selectBox-dropdown-menu")}z(d);return d}};var i=function(b){var c=a(b).find("OPTION:selected");return("selectBox-label "+(c.attr("class")||"")).replace(/\s+$/,"")};var j=function(b){var c=a(b).find("OPTION:selected");return c.text()||" "};var k=function(b){b=a(b);var c=b.data("selectBox-control");if(!c)return;c.find(".selectBox-label").attr("class",i(b)).text(j(b))};var l=function(b){b=a(b);var c=b.data("selectBox-control");if(!c)return;var d=c.data("selectBox-options");d.remove();c.remove();b.removeClass("selectBox").removeData("selectBox-control").data("selectBox-control",null).removeData("selectBox-settings").data("selectBox-settings",null).show()};var m=function(b){b=a(b);b.selectBox("options",b.html())};var n=function(b){b=a(b);var c=b.data("selectBox-control"),d=b.data("selectBox-settings"),e=c.data("selectBox-options");if(c.hasClass("selectBox-disabled"))return false;o();var f=isNaN(c.css("borderBottomWidth"))?0:parseInt(c.css("borderBottomWidth"));e.width(c.innerWidth()).css({top:c.offset().top+c.outerHeight()-f,left:c.offset().left});if(b.triggerHandler("beforeopen"))return false;var g=function(){b.triggerHandler("open",{_selectBox:true})};switch(d.menuTransition){case"fade":e.fadeIn(d.menuSpeed,g);break;case"slide":e.slideDown(d.menuSpeed,g);break;default:e.show(d.menuSpeed,g);break}if(!d.menuSpeed)g();var h=e.find(".selectBox-selected:first");s(b,h,true);q(b,h);c.addClass("selectBox-menuShowing");a(document).bind("mousedown.selectBox",function(b){if(a(b.target).parents().andSelf().hasClass("selectBox-options"))return;o()})};var o=function(){if(a(".selectBox-dropdown-menu:visible").length===0)return;a(document).unbind("mousedown.selectBox");a(".selectBox-dropdown-menu").each(function(){var b=a(this),c=b.data("selectBox-select"),d=c.data("selectBox-control"),e=c.data("selectBox-settings");if(c.triggerHandler("beforeclose"))return false;var f=function(){c.triggerHandler("close",{_selectBox:true})};switch(e.menuTransition){case"fade":b.fadeOut(e.menuSpeed,f);break;case"slide":b.slideUp(e.menuSpeed,f);break;default:b.hide(e.menuSpeed,f);break}if(!e.menuSpeed)f();d.removeClass("selectBox-menuShowing")})};var p=function(b,c,d){b=a(b);c=a(c);var e=b.data("selectBox-control"),g=b.data("selectBox-settings");if(e.hasClass("selectBox-disabled"))return false;if(c.length===0||c.hasClass("selectBox-disabled"))return false;if(b.attr("multiple")){if(d.shiftKey&&e.data("selectBox-last-selected")){c.toggleClass("selectBox-selected");var h;if(c.index()>e.data("selectBox-last-selected").index()){h=c.siblings().slice(e.data("selectBox-last-selected").index(),c.index())}else{h=c.siblings().slice(c.index(),e.data("selectBox-last-selected").index())}h=h.not(".selectBox-optgroup, .selectBox-disabled");if(c.hasClass("selectBox-selected")){h.addClass("selectBox-selected")}else{h.removeClass("selectBox-selected")}}else if(f&&d.metaKey||!f&&d.ctrlKey){c.toggleClass("selectBox-selected")}else{c.siblings().removeClass("selectBox-selected");c.addClass("selectBox-selected")}}else{c.siblings().removeClass("selectBox-selected");c.addClass("selectBox-selected")}if(e.hasClass("selectBox-dropdown")){e.find(".selectBox-label").text(c.text())}var i=0,j=[];if(b.attr("multiple")){e.find(".selectBox-selected A").each(function(){j[i++]=a(this).attr("rel")})}else{j=c.find("A").attr("rel")}e.data("selectBox-last-selected",c);if(b.val()!==j){b.val(j);k(b);b.trigger("change")}return true};var q=function(b,c){b=a(b);c=a(c);var d=b.data("selectBox-control"),e=d.data("selectBox-options");e.find(".selectBox-hover").removeClass("selectBox-hover");c.addClass("selectBox-hover")};var r=function(b,c){b=a(b);c=a(c);var d=b.data("selectBox-control"),e=d.data("selectBox-options");e.find(".selectBox-hover").removeClass("selectBox-hover")};var s=function(b,c,d){if(!c||c.length===0)return;b=a(b);var e=b.data("selectBox-control"),f=e.data("selectBox-options"),g=e.hasClass("selectBox-dropdown")?f:f.parent(),h=parseInt(c.offset().top-g.position().top),i=parseInt(h+c.outerHeight());if(d){g.scrollTop(c.offset().top-g.offset().top+g.scrollTop()-g.height()/2)}else{if(h<0){g.scrollTop(c.offset().top-g.offset().top+g.scrollTop())}if(i>g.height()){g.scrollTop(c.offset().top+c.outerHeight()-g.offset().top+g.scrollTop()-g.height())}}};var t=function(b,c){b=a(b);var d=b.data("selectBox-control"),f=d.data("selectBox-options"),g=b.data("selectBox-settings"),h=0,i=0;if(d.hasClass("selectBox-disabled"))return;switch(c.keyCode){case 8:c.preventDefault();e="";break;case 9:case 27:o();r(b);break;case 13:if(d.hasClass("selectBox-menuShowing")){p(b,f.find("LI.selectBox-hover:first"),c);if(d.hasClass("selectBox-dropdown"))o()}else{n(b)}break;case 38:case 37:c.preventDefault();if(d.hasClass("selectBox-menuShowing")){var j=f.find(".selectBox-hover").prev("LI");h=f.find("LI:not(.selectBox-optgroup)").length;i=0;while(j.length===0||j.hasClass("selectBox-disabled")||j.hasClass("selectBox-optgroup")){j=j.prev("LI");if(j.length===0){if(g.loopOptions){j=f.find("LI:last")}else{j=f.find("LI:first")}}if(++i>=h)break}q(b,j);p(b,j,c);s(b,j)}else{n(b)}break;case 40:case 39:c.preventDefault();if(d.hasClass("selectBox-menuShowing")){var k=f.find(".selectBox-hover").next("LI");h=f.find("LI:not(.selectBox-optgroup)").length;i=0;while(k.length===0||k.hasClass("selectBox-disabled")||k.hasClass("selectBox-optgroup")){k=k.next("LI");if(k.length===0){if(g.loopOptions){k=f.find("LI:first")}else{k=f.find("LI:last")}}if(++i>=h)break}q(b,k);p(b,k,c);s(b,k)}else{n(b)}break}};var u=function(b,c){b=a(b);var f=b.data("selectBox-control"),g=f.data("selectBox-options");if(f.hasClass("selectBox-disabled"))return;switch(c.keyCode){case 9:case 27:case 13:case 38:case 37:case 40:case 39:break;default:if(!f.hasClass("selectBox-menuShowing"))n(b);c.preventDefault();clearTimeout(d);e+=String.fromCharCode(c.charCode||c.keyCode);g.find("A").each(function(){if(a(this).text().substr(0,e.length).toLowerCase()===e.toLowerCase()){q(b,a(this).parent());s(b,a(this).parent());return false}});d=setTimeout(function(){e=""},1e3);break}};var v=function(b){b=a(b);b.attr("disabled",false);var c=b.data("selectBox-control");if(!c)return;c.removeClass("selectBox-disabled")};var w=function(b){b=a(b);b.attr("disabled",true);var c=b.data("selectBox-control");if(!c)return;c.addClass("selectBox-disabled")};var x=function(b,c){b=a(b);b.val(c);c=b.val();var d=b.data("selectBox-control");if(!d)return;var e=b.data("selectBox-settings"),f=d.data("selectBox-options");k(b);f.find(".selectBox-selected").removeClass("selectBox-selected");f.find("A").each(function(){if(typeof c==="object"){for(var b=0;b<c.length;b++){if(a(this).attr("rel")==c[b]){a(this).parent().addClass("selectBox-selected")}}}else{if(a(this).attr("rel")==c){a(this).parent().addClass("selectBox-selected")}}});if(e.change)e.change.call(b)};var y=function(b,d){b=a(b);var e=b.data("selectBox-control"),f=b.data("selectBox-settings");switch(typeof c){case"string":b.html(c);break;case"object":b.html("");for(var g in c){if(c[g]===null)continue;if(typeof c[g]==="object"){var i=a('<optgroup label="'+g+'" />');for(var j in c[g]){i.append('<option value="'+j+'">'+c[g][j]+"</option>")}b.append(i)}else{var l=a('<option value="'+g+'">'+c[g]+"</option>");b.append(l)}}break}if(!e)return;e.data("selectBox-options").remove();var m=e.hasClass("selectBox-dropdown")?"dropdown":"inline";d=h(b,m);e.data("selectBox-options",d);switch(m){case"inline":e.append(d);break;case"dropdown":k(b);a("BODY").append(d);break}};var z=function(b){a(b).css("MozUserSelect","none").bind("selectstart",function(a){a.preventDefault()})};var A=function(b,c){var d=a("<li />"),e=a("<a />");d.addClass(b.attr("class"));d.data(b.data());e.attr({rel:b.val(),title:b.text()}).text(b.text());d.append(e);if(b.attr("disabled"))d.addClass("selectBox-disabled");if(b.attr("selected"))d.addClass("selectBox-selected");c.append(d)};switch(b){case"control":return a(this).data("selectBox-control");case"settings":if(!c)return a(this).data("selectBox-settings");a(this).each(function(){a(this).data("selectBox-settings",a.extend(true,a(this).data("selectBox-settings"),c))});break;case"options":if(c===undefined)return a(this).data("selectBox-control").data("selectBox-options");a(this).each(function(){y(this,c)});break;case"value":if(c===undefined)return a(this).val();a(this).each(function(){x(this,c)});break;case"refresh":a(this).each(function(){m(this)});break;case"enable":a(this).each(function(){v(this)});break;case"disable":a(this).each(function(){w(this)});break;case"destroy":a(this).each(function(){l(this)});break;default:a(this).each(function(){g(this,b)});break}return a(this)}})})(jQuery);