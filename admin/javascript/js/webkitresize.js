(function(a){a.fn.webkitimageresize=function(b){return this.each(function(){if(!a.browser.webkit){return}var c=a.extend({},b);var d;var e=false;var f;var g={removeResizeElements:function(b){a(".resize-selector").remove();a(".resize-region").remove()},imageClick:function(b,d){if(c.beforeElementSelect){c.beforeElementSelect(d)}g.removeResizeElements();f=d;var h=a(d).outerHeight();var i=a(d).outerWidth();var j=b.$ifrm.offset();var k=a(d).offset();var l=b.$ifrmBody.scrollTop();var m=b.$ifrmBody.scrollLeft();b.$docBody.append("<span class='resize-selector' style='margin:10px; position:absolute; top:"+(j.top+k.top-l+h-10)+"px; left:"+(j.left+k.left-m+i-10)+"px; border:solid 2px red; width:6px; height:6px; cursor:se-resize; z-index:1;'></span>");b.$docBody.append("<span class='resize-region region-top-right' style='position:absolute; top:"+(j.top+k.top-l)+"px; left:"+(j.left+k.left-m)+"px; border:dashed 1px grey !important; width:"+i+"px; height:0px;'></span>");b.$docBody.append("<span class='resize-region region-top-down' style='position:absolute; top:"+(j.top+k.top-l)+"px; left:"+(j.left+k.left-m)+"px; border:dashed 1px grey !important; width:0px; height:"+h+"px;'></span>");b.$docBody.append("<span class='resize-region region-right-down' style='position:absolute; top:"+(j.top+k.top-l)+"px; left:"+(j.left+k.left-m+i)+"px; border:dashed 1px grey !important; width:0px; height:"+h+"px;'></span>");b.$docBody.append("<span class='resize-region region-down-left' style='position:absolute; top:"+(j.top+k.top-l+h)+"px; left:"+(j.left+k.left-m)+"px; border:dashed 1px grey !important; width:"+i+"px; height:0px;'></span>");var n=function(){if(e){a(f).css("width",a(".region-top-right").width()+"px").css("height",a(".region-top-down").height()+"px");g.refresh(b);a(f).click();a(document).trigger("webkitresize-updatecrc",[g.crc(b.$ifrmBody.html())]);e=false;if(c.afterResize){c.afterResize(f)}}};var o=function(b){if(e){var c=i;var d=h;d=b.pageY-k.top;c=b.pageX-k.left;if(d<1){d=1}if(c<1){c=1}a(".resize-selector").css("top",j.top+k.top-l+d-10+"px").css("left",j.left+k.left-m+c-10+"px");a(".region-top-right").css("width",c+"px");a(".region-top-down").css("height",d+"px");a(".region-right-down").css("left",j.left+k.left-m+c+"px").css("height",d+"px");a(".region-down-left").css("top",j.top+k.top-l+d+"px").css("width",c+"px")}return false};var p=function(b){if(e){var c=i;var d=h;d=b.pageY-(j.top+k.top-l);c=b.pageX-(j.left+k.left-m);if(d<1){d=1}if(c<1){c=1}a(".resize-selector").css("top",j.top+k.top-l+d-10+"px").css("left",j.left+k.left-m+c-10+"px");a(".region-top-right").css("width",c+"px");a(".region-top-down").css("height",d+"px");a(".region-right-down").css("left",j.left+k.left-m+c+"px").css("height",d+"px");a(".region-down-left").css("top",j.top+k.top-l+d+"px").css("width",c+"px")}return false};a(".resize-selector").mousedown(function(a){if(c.beforeResizeStart){c.beforeResizeStart(f)}e=true;return false});a("*").mouseup(function(){if(e){n()}});a(b.ifrm.contentWindow).mousemove(function(a){o(a)});a(window).mousemove(function(a){p(a)});if(c.afterElementSelect){c.afterElementSelect(f)}},rebind:function(b){b.$ifrm.contents().find("img").each(function(c,d){a(d).unbind("click");a(d).click(function(a){if(a.target==d){g.imageClick(b,d)}})})},refresh:function(b){g.rebind(b);g.removeResizeElements();if(!f){if(c.afterRefresh){c.afterRefresh(null)}return}var e=f;var h=a(e).outerHeight();var i=a(e).outerWidth();var j=b.$ifrm.offset();var k=a(e).offset();var l=b.$ifrmBody.scrollTop();var m=b.$ifrmBody.scrollLeft();b.$docBody.append("<span class='resize-selector' style='position:absolute; top:"+(j.top+k.top-l+h)+"px; left:"+(j.left+k.left-m+i)+"px; border:solid 2px red; width:6px; height:6px; cursor:se-resize; z-index:1;'></span>");b.$docBody.append("<span class='resize-region' style='position:absolute; top:"+(j.top+k.top-l)+"px; left:"+(j.left+k.left-m)+"px; border:dashed 1px grey !important; width:"+i+"px; height:0px;'></span>");b.$docBody.append("<span class='resize-region' style='position:absolute; top:"+(j.top+k.top-l)+"px; left:"+(j.left+k.left-m)+"px; border:dashed 1px grey !important; width:0px; height:"+h+"px;'></span>");b.$docBody.append("<span class='resize-region' style='position:absolute; top:"+(j.top+k.top-l)+"px; left:"+(j.left+k.left-m+i)+"px; border:dashed 1px grey !important; width:0px; height:"+h+"px;'></span>");b.$docBody.append("<span class='resize-region' style='position:absolute; top:"+(j.top+k.top-l+h)+"px; left:"+(j.left+k.left-m)+"px; border:dashed 1px grey !important; width:"+i+"px; height:0px;'></span>");d=g.crc(b.$ifrmBody.html());if(c.afterRefresh){c.afterRefresh(f)}},reset:function(a){f=null;e=false;g.removeResizeElements();g.rebind(a);d=g.crc(a.$ifrmBody.html());if(c.afterReset){c.afterReset()}},crc:function(a){var b=0;if(a.length==0)return b;for(i=0;i<a.length;i++){char=a.charCodeAt(i);b=(b<<5)-b+char;b=b&b}return b}};var h=this;var j=a(this);var k=a("body");var l=j.contents().find("body");d=g.crc(l.html());if(!j.is("iframe")){return}var m={ifrm:h,$ifrm:j,$docBody:k,$ifrmBody:l};h.contentWindow.addEventListener("scroll",function(){g.reset(m)},false);a(h.contentWindow.document).keyup(function(){if(!e){g.reset(m)}}).mouseup(function(b){if(d!=g.crc(l.html())){g.reset(m)}else{var c=b.x?b.x:b.clientX;var e=b.y?b.y:b.clientY;var f=h.contentWindow.document.elementFromPoint(c,e);if(f){if(!a(f).is("img")){g.reset(m)}}else{g.reset(m)}}});a(document).keyup(function(a){if(a.keyCode==27){g.reset(m)}});setInterval(function(){if(!e&&d!=g.crc(l.html())){g.reset(m)}},1e3);a(document).bind("webkitresize-updatecrc",function(a,b){d=b});g.refresh(m)})};a.fn.webkittableresize=function(b){return this.each(function(){if(!a.browser.webkit){return}var c=a.extend({},b);var d;var e=false;var f;var g={removeResizeElements:function(b){a(".resize-selector").remove();a(".resize-region").remove()},tableClick:function(b,d){if(c.beforeElementSelect){c.beforeElementSelect(d)}g.removeResizeElements();f=d;var h=a(d).outerHeight();var i=a(d).outerWidth();var j=b.$ifrm.offset();var k=a(d).offset();var l=b.$ifrmBody.scrollTop();var m=b.$ifrmBody.scrollLeft();b.$docBody.append("<span class='resize-selector' style='margin:10px;position:absolute;top:"+(j.top+k.top-l+h-10)+"px;left:"+(j.left+k.left-m+i-10)+"px;border:solid 2px red;;width:6px;height:6px;cursor:se-resize;z-index:1;'></span>");b.$docBody.append("<span class='resize-region region-top-right' style='position:absolute;top:"+(j.top+k.top-l)+"px;left:"+(j.left+k.left-m)+"px;border:dashed 1px grey;;width:"+i+"px;height:0px;'></span>");b.$docBody.append("<span class='resize-region region-top-down' style='position:absolute;top:"+(j.top+k.top-l)+"px;left:"+(j.left+k.left-m)+"px;border:dashed 1px grey;;width:0px;height:"+h+"px;'></span>");b.$docBody.append("<span class='resize-region region-right-down' style='position:absolute;top:"+(j.top+k.top-l)+"px;left:"+(j.left+k.left-m+i)+"px;border:dashed 1px grey;;width:0px;height:"+h+"px;'></span>");b.$docBody.append("<span class='resize-region region-down-left' style='position:absolute;top:"+(j.top+k.top-l+h)+"px;left:"+(j.left+k.left-m)+"px;border:dashed 1px grey;;width:"+i+"px;height:0px;'></span>");var n=function(){if(e){a(f).css("width",a(".region-top-right").width()+"px").css("height",a(".region-top-down").height()+"px");g.refresh(b);a(f).click();a(document).trigger("webkitresize-updatecrc",[g.crc(b.$ifrmBody.html())]);e=false;if(c.afterResize){c.afterResize(f)}}};var o=function(b){if(e){var c=i;var d=h;d=b.pageY-k.top;c=b.pageX-k.left;if(d<1){d=1}if(c<1){c=1}a(".resize-selector").css("top",j.top+k.top-l+d-10+"px").css("left",j.left+k.left-m+c-10+"px");a(".region-top-right").css("width",c+"px");a(".region-top-down").css("height",d+"px");a(".region-right-down").css("left",j.left+k.left-m+c+"px").css("height",d+"px");a(".region-down-left").css("top",j.top+k.top-l+d+"px").css("width",c+"px")}return false};var p=function(b){if(e){var c=i;var d=h;d=b.pageY-(j.top+k.top-l);c=b.pageX-(j.left+k.left-m);if(d<1){d=1}if(c<1){c=1}a(".resize-selector").css("top",j.top+k.top-l+d-10+"px").css("left",j.left+k.left-m+c-10+"px");a(".region-top-right").css("width",c+"px");a(".region-top-down").css("height",d+"px");a(".region-right-down").css("left",j.left+k.left-m+c+"px").css("height",d+"px");a(".region-down-left").css("top",j.top+k.top-l+d+"px").css("width",c+"px")}return false};a(".resize-selector").mousedown(function(a){if(c.beforeResizeStart){c.beforeResizeStart(f)}e=true;return false});a("*").mouseup(function(){if(e){n()}});a(b.ifrm.contentWindow).mousemove(function(a){o(a)});a(window).mousemove(function(a){p(a)});if(c.afterElementSelect){c.afterElementSelect(f)}},rebind:function(b){b.$ifrm.contents().find("table").each(function(c,d){a(d).unbind("click");a(d).click(function(c){if(c.target==d||a(c.target).is("td")&&a(c.target).parents("table")[0]==d){g.tableClick(b,d)}})})},refresh:function(b){g.rebind(b);g.removeResizeElements();if(!f){if(c.afterRefresh){c.afterRefresh(null)}return}var e=f;var h=a(e).outerHeight();var i=a(e).outerWidth();var j=b.$ifrm.offset();var k=a(e).offset();var l=b.$ifrmBody.scrollTop();var m=b.$ifrmBody.scrollLeft();b.$docBody.append("<span class='resize-selector' style='position:absolute;top:"+(j.top+k.top-l+h)+"px;left:"+(j.left+k.left-m+i)+"px;border:solid 2px red;;width:6px;height:6px;cursor:se-resize;z-index:1;'></span>");b.$docBody.append("<span class='resize-region' style='position:absolute;top:"+(j.top+k.top-l)+"px;left:"+(j.left+k.left-m)+"px;border:dashed 1px grey;;width:"+i+"px;height:0px;'></span>");b.$docBody.append("<span class='resize-region' style='position:absolute;top:"+(j.top+k.top-l)+"px;left:"+(j.left+k.left-m)+"px;border:dashed 1px grey;;width:0px;height:"+h+"px;'></span>");b.$docBody.append("<span class='resize-region' style='position:absolute;top:"+(j.top+k.top-l)+"px;left:"+(j.left+k.left-m+i)+"px;border:dashed 1px grey;;width:0px;height:"+h+"px;'></span>");b.$docBody.append("<span class='resize-region' style='position:absolute;top:"+(j.top+k.top-l+h)+"px;left:"+(j.left+k.left-m)+"px;border:dashed 1px grey;;width:"+i+"px;height:0px;'></span>");d=g.crc(b.$ifrmBody.html());if(c.afterRefresh){c.afterRefresh(f)}},reset:function(a){f=null;e=false;g.removeResizeElements();g.rebind(a);d=g.crc(a.$ifrmBody.html());if(c.afterReset){c.afterReset()}},crc:function(a){var b=0;if(a.length==0)return b;for(i=0;i<a.length;i++){char=a.charCodeAt(i);b=(b<<5)-b+char;b=b&b}return b}};var h=this;var j=a(this);var k=a("body");var l=j.contents().find("body");d=g.crc(l.html());if(!j.is("iframe")){return}var m={ifrm:h,$ifrm:j,$docBody:k,$ifrmBody:l};h.contentWindow.addEventListener("scroll",function(){g.reset(m)},false);a(h.contentWindow.document).keyup(function(){if(!e){g.reset(m)}}).mouseup(function(b){if(d!=g.crc(l.html())){g.reset(m)}else{var c=b.x?b.x:b.clientX;var e=b.y?b.y:b.clientY;var f=h.contentWindow.document.elementFromPoint(c,e);if(f){if(!a(f).is("table")){g.reset(m)}}else{g.reset(m)}}});a(document).keyup(function(a){if(a.keyCode==27){g.reset(m)}});setInterval(function(){if(!e&&d!=g.crc(l.html())){g.reset(m)}},1e3);a(document).bind("webkitresize-updatecrc",function(a,b){d=b});g.refresh(m)})};a.fn.webkittdresize=function(b){return this.each(function(){if(!a.browser.webkit){return}var c=a.extend({},b);var d;var e=false;var f;var g={removeResizeElements:function(b){a(".td-resize-selector").remove();a(".td-resize-region").remove()},tdClick:function(b,d){if(c.beforeElementSelect){c.beforeElementSelect(d)}g.removeResizeElements();f=d;var h=a(d).outerHeight();var i=a(d).outerWidth();var j=b.$ifrm.offset();var k=a(d).offset();var l=b.$ifrmBody.scrollTop();var m=b.$ifrmBody.scrollLeft();b.$docBody.append("<span class='td-resize-selector' style='margin:10px;position:absolute;top:"+(j.top+k.top-l+h-10)+"px;left:"+(j.left+k.left-m+i-10)+"px;border:solid 2px red;width:6px;height:6px;cursor:se-resize;z-index:1;'></span>");b.$docBody.append("<span class='td-resize-region td-region-top-right' style='position:absolute;top:"+(j.top+k.top-l)+"px;left:"+(j.left+k.left-m)+"px;border:dashed 1px green;width:"+i+"px;height:0px;'></span>");b.$docBody.append("<span class='td-resize-region td-region-top-down' style='position:absolute;top:"+(j.top+k.top-l)+"px;left:"+(j.left+k.left-m)+"px;border:dashed 1px green;width:0px;height:"+h+"px;'></span>");b.$docBody.append("<span class='td-resize-region td-region-right-down' style='position:absolute;top:"+(j.top+k.top-l)+"px;left:"+(j.left+k.left-m+i)+"px;border:dashed 1px green;width:0px;height:"+h+"px;'></span>");b.$docBody.append("<span class='td-resize-region td-region-down-left' style='position:absolute;top:"+(j.top+k.top-l+h)+"px;left:"+(j.left+k.left-m)+"px;border:dashed 1px green;width:"+i+"px;height:0px;'></span>");var n=function(){if(e){a(f).css("width",a(".td-region-top-right").width()+"px").css("height",a(".td-region-top-down").height()+"px");g.refresh(b);a(f).click();a(document).trigger("webkitresize-updatecrc",[g.crc(b.$ifrmBody.html())]);e=false;if(c.afterResize){c.afterResize(f)}}};var o=function(b){if(e){var c=i;var d=h;d=b.pageY-k.top;c=b.pageX-k.left;if(d<1){d=1}if(c<1){c=1}a(".td-resize-selector").css("top",j.top+k.top-l+d-10+"px").css("left",j.left+k.left-m+c-10+"px");a(".td-region-top-right").css("width",c+"px");a(".td-region-top-down").css("height",d+"px");a(".td-region-right-down").css("left",j.left+k.left-m+c+"px").css("height",d+"px");a(".td-region-down-left").css("top",j.top+k.top-l+d+"px").css("width",c+"px")}return false};var p=function(b){if(e){var c=i;var d=h;d=b.pageY-(j.top+k.top-l);c=b.pageX-(j.left+k.left-m);if(d<1){d=1}if(c<1){c=1}a(".td-resize-selector").css("top",j.top+k.top-l+d-10+"px").css("left",j.left+k.left-m+c-10+"px");a(".td-region-top-right").css("width",c+"px");a(".td-region-top-down").css("height",d+"px");a(".td-region-right-down").css("left",j.left+k.left-m+c+"px").css("height",d+"px");a(".td-region-down-left").css("top",j.top+k.top-l+d+"px").css("width",c+"px")}return false};a(".td-resize-selector").mousedown(function(a){if(c.beforeResizeStart){c.beforeResizeStart(f)}e=true;return false});a("*").mouseup(function(){if(e){n()}});a(b.ifrm.contentWindow).mousemove(function(a){o(a)});a(window).mousemove(function(a){p(a)});if(c.afterElementSelect){c.afterElementSelect(f)}},rebind:function(b){b.$ifrm.contents().find("td").each(function(c,d){a(d).unbind("click");a(d).click(function(a){if(a.target==d){g.tdClick(b,d)}})})},refresh:function(b){g.rebind(b);g.removeResizeElements();if(!f){if(c.afterRefresh){c.afterRefresh(null)}return}var e=f;var h=a(e).outerHeight();var i=a(e).outerWidth();var j=b.$ifrm.offset();var k=a(e).offset();var l=b.$ifrmBody.scrollTop();var m=b.$ifrmBody.scrollLeft();b.$docBody.append("<span class='td-resize-selector' style='position:absolute;top:"+(j.top+k.top-l+h)+"px;left:"+(j.left+k.left-m+i)+"px;border:solid 2px red;;width:6px;height:6px;cursor:se-resize;z-index:1;'></span>");b.$docBody.append("<span class='td-resize-region' style='position:absolute;top:"+(j.top+k.top-l)+"px;left:"+(j.left+k.left-m)+"px;border:dashed 1px grey;;width:"+i+"px;height:0px;'></span>");b.$docBody.append("<span class='td-resize-region' style='position:absolute;top:"+(j.top+k.top-l)+"px;left:"+(j.left+k.left-m)+"px;border:dashed 1px grey;;width:0px;height:"+h+"px;'></span>");b.$docBody.append("<span class='td-resize-region' style='position:absolute;top:"+(j.top+k.top-l)+"px;left:"+(j.left+k.left-m+i)+"px;border:dashed 1px grey;;width:0px;height:"+h+"px;'></span>");b.$docBody.append("<span class='td-resize-region' style='position:absolute;top:"+(j.top+k.top-l+h)+"px;left:"+(j.left+k.left-m)+"px;border:dashed 1px grey;;width:"+i+"px;height:0px;'></span>");d=g.crc(b.$ifrmBody.html());if(c.afterRefresh){c.afterRefresh(f)}},reset:function(a){f=null;e=false;g.removeResizeElements();g.rebind(a);d=g.crc(a.$ifrmBody.html());if(c.afterReset){c.afterReset()}},crc:function(a){var b=0;if(a.length==0)return b;for(i=0;i<a.length;i++){char=a.charCodeAt(i);b=(b<<5)-b+char;b=b&b}return b}};var h=this;var j=a(this);var k=a("body");var l=j.contents().find("body");d=g.crc(l.html());if(!j.is("iframe")){return}var m={ifrm:h,$ifrm:j,$docBody:k,$ifrmBody:l};h.contentWindow.addEventListener("scroll",function(){g.reset(m)},false);a(h.contentWindow.document).keyup(function(){if(!e){g.reset(m)}}).mouseup(function(b){if(d!=g.crc(l.html())){g.reset(m)}else{var c=b.x?b.x:b.clientX;var e=b.y?b.y:b.clientY;var f=h.contentWindow.document.elementFromPoint(c,e);if(f){if(!a(f).is("td")){g.reset(m)}}else{g.reset(m)}}});a(document).keyup(function(a){if(a.keyCode==27){g.reset(m)}});setInterval(function(){if(!e&&d!=g.crc(l.html())){g.reset(m)}},1e3);g.refresh(m)})}})(jQuery);