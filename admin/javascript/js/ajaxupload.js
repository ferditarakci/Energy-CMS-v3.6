(function(){function a(a){return/[.]/.exec(a)?/[^.]+$/.exec(a.toLowerCase()):""}function b(a){return a.replace(/.*(\/|\\)/,"")}function c(a){if(!a.pageX&&a.clientX){var b=1;var c=document.body;if(c.getBoundingClientRect){var d=c.getBoundingClientRect();b=(d.right-d.left)/c.clientWidth}return{x:a.clientX/b+j.body.scrollLeft+j.documentElement.scrollLeft,y:a.clientY/b+j.body.scrollTop+j.documentElement.scrollTop}}return{x:a.pageX,y:a.pageY}}function d(a){var b,c,d,e;var f=m(a);b=f.left;d=f.top;c=b+a.offsetWidth;e=d+a.offsetHeight;return{left:b,right:c,top:d,bottom:e}}function e(a,b){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=a.className.replace(c," ")}function f(a,b){if(!g(a,b))a.className+=" "+b}function g(a,b){return a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}function h(a,b,c){if(k.addEventListener){a.addEventListener(b,c,false)}else if(k.attachEvent){var d=function(){c.call(a,k.event)};a.attachEvent("on"+b,d)}}function i(a){if(typeof a=="string")a=j.getElementById(a);return a}var j=document,k=window;var l=function(){var a=j.createElement("div");return function(b){a.innerHTML=b;var c=a.childNodes[0];a.removeChild(c);return c}}();if(document.documentElement["getBoundingClientRect"]){var m=function(a){var b=a.getBoundingClientRect(),c=a.ownerDocument,d=c.body,e=c.documentElement,f=e.clientTop||d.clientTop||0,g=e.clientLeft||d.clientLeft||0,h=1;if(d.getBoundingClientRect){var i=d.getBoundingClientRect();h=(i.right-i.left)/d.clientWidth}if(h>1){f=0;g=0}var j=b.top/h+(window.pageYOffset||e&&e.scrollTop/h||d.scrollTop/h)-f,k=b.left/h+(window.pageXOffset||e&&e.scrollLeft/h||d.scrollLeft/h)-g;return{top:j,left:k}}}else{var m=function(a){if(k.jQuery){return jQuery(a).offset()}var b=0,c=0;do{b+=a.offsetTop||0;c+=a.offsetLeft||0}while(a=a.offsetParent);return{left:c,top:b}}}var n=function(){var a=0;return function(){return"ValumsAjaxUpload"+a++}}();Ajax_upload=AjaxUpload=function(a,b){if(a.jquery){a=a[0]}else if(typeof a=="string"&&/^#.*/.test(a)){a=a.slice(1)}a=i(a);this._input=null;this._button=a;this._disabled=false;this._submitting=false;this._justClicked=false;this._parentDialog=j.body;if(window.jQuery&&jQuery.ui&&jQuery.ui.dialog){var c=jQuery(this._button).parents(".ui-dialog");if(c.length){this._parentDialog=c[0]}}this._settings={action:"upload.php",name:"userfile",data:{},autoSubmit:true,multi:false,accept:false,responseType:false,onChange:function(a,b){},onSubmit:function(a,b){},onComplete:function(a,b){}};for(var d in b){this._settings[d]=b[d]}this._createInput();this._rerouteClicks()};AjaxUpload.prototype={setData:function(a){this._settings.data=a},disable:function(){this._disabled=true},enable:function(){this._disabled=false},destroy:function(){if(this._input){if(this._input.parentNode){this._input.parentNode.removeChild(this._input)}this._input=null}},_createInput:function(){var c=this;var d=j.createElement("input");d.setAttribute("type","file");if(this._settings.multi){d.setAttribute("multiple","multiple");d.setAttribute("max","10")}if(this._settings.accept=="image"){d.setAttribute("accept","image/gif,image/png,image/jpeg")}d.setAttribute("class","fileButton");d.setAttribute("id","energy_"+this._settings.name+"_button");d.setAttribute("name",this._settings.name+"[]");var e={position:"absolute",margin:"-12px 0 0 -180px",padding:0,opacity:0,width:"220px",height:"30px",fontSize:"14px",cursor:"pointer",display:"none",zIndex:2147483583};for(var f in e){d.style[f]=e[f]}if(!(d.style.opacity==="0")){d.style.filter="alpha(opacity=0)"}this._parentDialog.appendChild(d);h(d,"change",function(){var d=b(this.value);if(c._settings.onChange.call(c,d,a(d))==false){return}if(c._settings.autoSubmit){c.submit()}});h(d,"click",function(){c.justClicked=true;setTimeout(function(){c.justClicked=false},3e3)});this._input=d},_rerouteClicks:function(){var a=this;var b,g={top:0,left:0},i=false;h(a._button,"mouseover",function(c){if(!a._input||i)return;i=true;b=d(a._button);if(a._parentDialog!=j.body){g=m(a._parentDialog)}});h(document,"mousemove",function(d){var h=a._input;if(!h||!i)return;if(a._disabled){e(a._button,"hover");h.style.display="none";return}var j=c(d);if(j.x>=b.left&&j.x<=b.right&&j.y>=b.top&&j.y<=b.bottom){h.style.top=j.y-g.top+"px";h.style.left=j.x-g.left+"px";h.style.display="block";f(a._button,"hover")}else{i=false;if(!a.justClicked){h.style.display="none"}e(a._button,"hover")}})},_createIframe:function(){var a=n();var b=l('<iframe src="javascript:false;" name="'+a+'" />');b.id=a;b.style.display="none";j.body.appendChild(b);return b},submit:function(){var c=this,d=this._settings;if(this._input.value===""){return}var e=b(this._input.value);if(!(d.onSubmit.call(this,e,a(e))==false)){var f=this._createIframe();var g=this._createForm(f);g.appendChild(this._input);g.submit();j.body.removeChild(g);g=null;this._input=null;this._createInput();var i=false;h(f,"load",function(a){if(f.src=="javascript:'%3Chtml%3E%3C/html%3E';"||f.src=="javascript:'<html></html>';"){if(i){setTimeout(function(){j.body.removeChild(f)},0)}return}var b=f.contentDocument?f.contentDocument:frames[f.id].document;if(b.readyState&&b.readyState!="complete"){return}if(b.body&&b.body.innerHTML=="false"){return}var g;if(b.XMLDocument){g=b.XMLDocument}else if(b.body){g=b.body.innerHTML;if(d.responseType&&d.responseType.toLowerCase()=="json"){if(b.body.firstChild&&b.body.firstChild.nodeName.toUpperCase()=="PRE"){g=b.body.firstChild.firstChild.nodeValue}if(g){g=window["eval"]("("+g+")")}else{g={}}}}else{var g=b}d.onComplete.call(c,e,g);i=true;f.src="javascript:'<html></html>';"})}else{j.body.removeChild(this._input);this._input=null;this._createInput()}},_createForm:function(a){var b=this._settings;var c=l('<form method="post" enctype="multipart/form-data"></form>');c.style.display="none";c.action=b.action;c.target=a.name;j.body.appendChild(c);for(var d in b.data){var e=j.createElement("input");e.type="hidden";e.name=d;e.value=b.data[d];c.appendChild(e)}return c}}})();